library(foreign)
Panel <-read.dta("http://dss.princeton.edu/training/Panel101.dta")
View(Panel)
panel <-read.dta("http://dss.princeton.edu/training/Panel101.dta")
colnames(panel)
sample(nrow(panel))
sample(6,nrow(panel))
sample(nrow(panel),nrow(panel)*.25)
sample(nrow(panel),nrow(panel)*.2)
panel$y[sample(nrow(panel),nrow(panel)*.2)]
panel$y[sample(nrow(panel),nrow(panel)*.2)]<-NA
View(panel)
library(tempura)
library(tempura)
devtools::load_all(".")
library(tempura)
library(tempura)
devtools::load_all(".")
devtools::load_all(".")
x<-read_dta("C:/Users/Machtei/OneDrive - University of North Carolina at Chapel Hill/Data/CWS/June22_workingupdate.dta")
x<-haven::read_dta("C:/Users/Machtei/OneDrive - University of North Carolina at Chapel Hill/Data/CWS/June22_workingupdate.dta")
dvpaul<-function(formula, dataset,idvar,timevar){
XVEC<-labels(terms(formula))
idvar <- deparse(substitute(idvar))
timevar <- deparse(substitute(timevar))
yvar <- all.vars(formula)[1]
dataz<-dataset %>% dplyr::select(all_of(c(idvar,timevar,yvar,XVEC)))
colnames(dataz)<-c("idv","timev",yvar,XVEC)
dataz<-na.omit(dataz)
polyd<-polydata(dataz,idv,timev)
fnew<-update(formula, . ~ . +t+t_cubed+t_squared)
poly_model<-lm(fnew,polyd)
return(poly_model)
}
dvpaul(csredist_feb22~ud21+leftcum+skew, x,idn,year)
dvpaul<-function(formula, dataset,idvar,timevar){
`%>%` <- magrittr::`%>%`
XVEC<-labels(terms(formula))
idvar <- deparse(substitute(idvar))
timevar <- deparse(substitute(timevar))
yvar <- all.vars(formula)[1]
dataz<-dataset %>% dplyr::select(all_of(c(idvar,timevar,yvar,XVEC)))
colnames(dataz)<-c("idv","timev",yvar,XVEC)
dataz<-na.omit(dataz)
polyd<-polydata(dataz,idv,timev)
fnew<-update(formula, . ~ . +t+t_cubed+t_squared)
poly_model<-lm(fnew,polyd)
return(poly_model)
}
dvpaul(csredist_feb22~ud21+leftcum+skew, x,idn,year)
polydata<-function(datasett,idvv,timevv){
`%>%` <- magrittr::`%>%`
idvv <- deparse(substitute(idvv))
timevv <- deparse(substitute(timevv))
datasett$idt<-datasett[[idvv]]
datasett$timet<-datasett[[timevv]]
datasett<-datasett[order(datasett$idt,datasett$timet),]
datasett<-datasett%>% dplyr::group_by(idt) %>% dplyr::mutate(t0=min(timet)) %>% dplyr::ungroup()
datasett$t<-datasett$timet-datasett$t0
datasett$t_squared<-datasett$t^2
datasett$t_cubed<-datasett$t^3
datasett$t0<-NULL
datasett$idt<-NULL
datasett$timet<-NULL
return(datasett)
}
dvpaul(csredist_feb22~ud21+leftcum+skew, x,idn,year)
devtools::load_all(".")
library(devtools)
detach("package:devtools", unload = TRUE)
remove.packages("devtools")
install.packages("devtools")
library(devtools)
R.version
remove.packages("devtools")
install.packages("devtools", type="binary")
libPaths()
remove.packages("devtools")
dvgreg<-function(formula, dataset,idvar,timevar){
`%>%` <- magrittr::`%>%`
XVEC<-labels(terms(formula))
idvar <- deparse(substitute(idvar))
timevar <- deparse(substitute(timevar))
yvar <- all.vars(formula)[1]
alv<-c(idvar,timevar,yvar,XVEC)
dataz<-dataset %>% dplyr::select(all_of(alv))
XVEC<-paste0(XVEC,"_varorg")
colnames(dataz)<-c("idv","timev","y",XVEC)
dataz<-dataz[order(dataz$idv,dataz$timev),]
dataz$temp<-ifelse(!is.na(dataz$y),1,0)
dataz <- dataz %>%
dplyr::group_by(idv) %>%
dplyr::mutate(seqv = cumsum(temp)) %>% dplyr::ungroup()
dataz$temp<-NULL
dataz$seqv<-ifelse(is.na(dataz$y),NA,dataz$seqv)
dataz$seqv2<-dataz$seqv
dataz$invtime=dataz$timev*-1
dataz <- dataz %>%
dplyr::group_by(idv) %>%
dplyr::arrange(idv, timev) %>%
tidyr::fill(seqv2, .direction = "down") %>%
dplyr::ungroup()
dataz <- dataz %>%
dplyr::group_by(idv,seqv2) %>%
dplyr::arrange(idv, seqv2,invtime) %>%
dplyr::mutate(s = dplyr::row_number() ) %>%
dplyr::ungroup()
dataz$s<-ifelse(!is.na(dataz$y),0,dataz$s)
dataz$seqv2<-ifelse(dataz$s==0,dataz$seqv-1,dataz$seqv2)
dataz <- dataz %>%
dplyr::group_by(idv, seqv2) %>%
dplyr::mutate(t_new = ifelse(s != 0, NA, sum(!is.na(seqv2))),.group="drop") %>%
dplyr::ungroup()
dataz<-dataz %>% dplyr::select(-.group)
dataz$t_new<-ifelse(dataz$seqv2==0,NA,dataz$t_new)
miss_d<-dataz %>% dplyr::select(all_of(XVEC))
colnames(miss_d)<-c(paste0("missobs_", XVEC))
miss_d<-ifelse(is.na(miss_d),1,NA)
dataz<-as.data.frame(cbind(dataz,miss_d))
rm(miss_d)
smfnk<-function(vc){
vc<-ifelse(is.na(vc),0,vc)
oc<-sum(vc)
return(oc)
}
dataz <-dataz %>%
dplyr::group_by(idv, seqv2) %>%
dplyr::mutate(
dplyr::across(
.cols=starts_with("missobs_"),
.fns = smfnk,
.names = "grdel_{.col}")) %>%
dplyr::ungroup()
dataz$ylag<-dataz$y
dataz <- dataz %>%
dplyr::group_by(idv) %>%
dplyr::arrange(idv, timev) %>%
tidyr::fill(ylag, .direction = "down") %>%
dplyr::ungroup()
dataz$ylag<-ifelse(dataz$seqv>1,dplyr::lag(dataz$ylag,1),NA)
rhoseq<-seq(.1,.9,.1)
ys<-as.data.frame(matrix(nrow=nrow(dataz),ncol=length(rhoseq)))
dvgregw<-as.data.frame(matrix(nrow=nrow(dataz),ncol=length(rhoseq)))
xs<-as.data.frame(matrix(nrow=nrow(dataz),ncol=(length(rhoseq)*length(XVEC))))
colnames(ys)<-paste("ys_",rhoseq,sep="")
colnames(dvgregw)<-paste("rho_multi_",rhoseq,sep="")
colnames(xs)<-paste(rep(XVEC,length(rhoseq)),"_rohconum",sort(rep(rhoseq,length(XVEC))),sep="")
#Loop to create X and Y data
for(a in rhoseq){
j<-a*10
#create new y
ys[,j]<-dataz$y-((1-a)^dataz$t_new)*dataz$ylag
dvgregw[,j]<-(1-a)^dataz$s
#create new xs
for (q in seq_along(XVEC)) {
xs[[paste(XVEC[q],"_rohconum",a,sep = "")]]<-(1-a)^dataz$s*dataz[[XVEC[q]]]
xs[[paste(XVEC[q],"_rohconum",a,sep = "")]]<-xs[[paste(XVEC[q],"_rohconum",a,sep = "")]]*a
}
}
dataz<-as.data.frame(cbind(dataz,ys,xs,dvgregw))
rm(xs,ys,dvgregw,a,j,q)
#Modifying X
dataz <- dataz %>%
dplyr::group_by(idv,seqv2) %>%
dplyr::arrange(idv, seqv2,seqv) %>%
dplyr::mutate(dplyr::across(colnames(dataz)[grepl("_rohconum0.",colnames(dataz))],~sum(.x, na.rm=T))) %>% dplyr::ungroup()
dataz<-dataz %>%
dplyr::mutate(dplyr::across(colnames(dataz)[grepl("_rohconum0.",colnames(dataz))],
~ ifelse(is.na(dataz$y)|dataz$seqv==1, NA, .x)))
for(a in rhoseq){
for (q in seq_along(XVEC)) {
dataz[[paste0(XVEC[q],"_rohconum",a)]]<-ifelse(dataz[[paste0("grdel_missobs_",XVEC[q])]]!=0,
NA,dataz[[paste0(XVEC[q],"_rohconum",a)]])
}
}
rm(a,q)
#############################################
#W
##########################################
dataz <- dataz %>% #############change dvgrew to reflect current one
dplyr::group_by(idv,seqv2) %>%
dplyr::arrange(idv, seqv2,seqv) %>%
dplyr::mutate(dplyr::across(colnames(dataz)[grepl("rho_multi_",colnames(dataz))],
~sum(.x, na.rm=T))) %>%
dplyr::ungroup()
dataz[,grep("rho_multi_",colnames(dataz))]<-1/dataz[,grep("rho_multi_",colnames(dataz))]
dataz<-dataz %>%
dplyr::mutate(dplyr::across(colnames(dataz)[grepl("rho_multi_",colnames(dataz))],
~ ifelse(is.na(dataz$y)|dataz$seqv==1, NA, .x)))
maxr2<--99
#modifyin vars
for(a in rhoseq){
dataz[[paste0("ys_",a)]]<-dataz[[paste0("rho_multi_",a)]]*dataz[[paste0("ys_",a)]]
for (q in seq_along(XVEC)) {
dataz[[paste0(XVEC[q],"_rohconum",a)]]<-dataz[[paste0("rho_multi_",a)]]*dataz[[paste0(XVEC[q],"_rohconum",a)]]
}
###################################
############Regression
###################################
subdata<-dataz %>% dplyr::select(idv,timev,paste0("ys_",a),paste0(XVEC,"_rohconum",a))
colnames(subdata)<-alv
subdata$constant<-a
nx<-colnames(subdata)[4:ncol(subdata)]
fnew<-as.formula(paste(colnames(subdata)[3],"~","0 +",paste(nx, collapse = " + ")))
#m<-dvgreglm(lm(fnew,subdata))
m<-lm(fnew,subdata)
if(summary(m)$r.squared>maxr2){
maxr2<-summary(m)$r.squared
model<-m
rho<-a
}
rm(m)
}
print(summary(model))
cat(paste("********************************************************************************",
"****************************** Model's Rho value: ******************************",
paste0("***********************************    ",rho,"    **********************************"),
"********************************************************************************",
sep="\n"))
return(model)
}
install.packages("devtools",dependencies=T)
R.version
library(devtools)
remotes::install_github("r-lib/later")
library(devtools)
library(dplyr)
library(tidyr)
library(tidyverse)
read.csv('https://data.nal.usda.gov/system/files/gfa25.csv')
panel<-read.csv('https://data.nal.usda.gov/system/files/gfa25.csv')
View(panel)
panel<-read.csv('https://www.lisdatacenter.org/wp-content/uploads/files/resources-Inequality%20Aversion-Datatset-CSV.csv')
View(panel)
View(Panel)
rm(Panel)
rm(panel)
panel<-read.csv('https://www.lisdatacenter.org/wp-content/uploads/files/resources-Inequality%20Aversion-Datatset-CSV.csv')
View(panel)
colnames(panel)
table(panel$Gini_S,panel$mean_gb2)
table(panel$Gini_S,panel$cname)
table(panel$mean_gb2,panel$cname)
summary(lm(mean_gb2~mean_gb2,panel)
summary(lm(mean_gb2~mean_gb2,panel)
summary(lm(mean_gb2~mean_gb2,panel))
summary(lm(Gini_S~mean_gb2,panel))
colnames(panel)
summary(lm(iGini~mean_gb2,panel))
summary(lm(Gini_S~iGini,panel))
summary(lm(mean~mean_gb2,panel))
read.csv('https://population.un.org/wpp/Download/Files/1_Indicators%20(Standard)/CSV_FILES/WPP2022_Demographic_Indicators_notes.csv'')
read.csv('https://population.un.org/wpp/Download/Files/1_Indicators%20(Standard)/CSV_FILES/WPP2022_Demographic_Indicators_notes.csv')
f<-read.csv('https://population.un.org/wpp/Download/Files/1_Indicators%20(Standard)/CSV_FILES/WPP2022_Demographic_Indicators_notes.csv')
View(f)
f<-read.csv('http://people.stern.nyu.edu/wgreene/Econometrics/healthcare.csv')
View(f)
table(f$HANDPER)
sum(is.na(f$HANDPER))
dnorm
?dnorm
library(devtools)
warning()
notes()
?devtools::document()
devtools::document("tempura")
library(tempura)
devtools::document("tempura")
?devtools::document(
?devtools::document()
devtools::document()
devtools::load_all(".")
library(tempura)
library(tempura)
library(tempura)
